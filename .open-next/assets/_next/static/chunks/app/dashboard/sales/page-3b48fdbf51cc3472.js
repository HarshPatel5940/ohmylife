(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[591],{2520:function(e,s,t){Promise.resolve().then(t.bind(t,293))},293:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return b}});var a=t(9533),n=t(1229),i=t(220),l=t(1250),r=t(5126),c=t(3191),o=t(2238),d=t(4912),u=t(2138),h=t(3103),x=t(322),m=t(3425),j=t(6513),p=t(1301),v=t(5477),g=t(4259),f=t(8070),N=t(2374);function b(){(0,l.useRouter)();let[e,s]=(0,n.useState)([]),[t,b]=(0,n.useState)(!0),[w,S]=(0,n.useState)(""),[y,C]=(0,n.useState)(!1),[k,D]=(0,n.useState)(null),[T,_]=(0,n.useState)(!1),[O,I]=(0,n.useState)(null),[P,Q]=(0,n.useState)([]),[F,R]=(0,n.useState)("income"),[z,A]=(0,n.useState)("invoice"),[E,L]=(0,n.useState)(""),[V,Z]=(0,n.useState)(""),[B,U]=(0,n.useState)("draft"),[M,q]=(0,n.useState)(""),[J,Y]=(0,n.useState)(""),[H,K]=(0,n.useState)("");(0,n.useEffect)(()=>{$(),G()},[]);let $=async()=>{try{let e=await fetch("/api/sales");if(e.ok){let t=await e.json();s(t)}}finally{b(!1)}},G=async()=>{try{let e=await fetch("/api/clients");if(e.ok){let s=await e.json();Q(s)}}catch(e){console.error("Failed to fetch clients",e)}},W=e=>{e?(D(e),R(e.type),A(e.invoiceNumber?"invoice":"sale"),L(e.amount.toString()),Z(e.amountReceived.toString()),U(e.status),q(e.dueDate?new Date(e.dueDate).toISOString().split("T")[0]:""),Y(e.invoiceNumber||""),K(e.clientId?e.clientId.toString():"")):X(),C(!0)},X=()=>{D(null),R("income"),A("invoice"),L(""),Z(""),U("draft"),q(""),Y(""),K("")},ee=async e=>{e.preventDefault();try{let e={type:F,amount:E,amountReceived:"sale"===z?E:V,status:"sale"===z?"paid":B,dueDate:M,invoiceNumber:"invoice"===z?J:void 0,clientId:H?parseInt(H):void 0};k?(await fetch("/ api / sales / ".concat(k.id," "),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok&&(C(!1),X(),$()):(await fetch("/api/sales",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok&&(C(!1),X(),$())}catch(e){console.error(e)}},es=e=>{I(e),_(!0)},et=async()=>{if(O)try{(await fetch("/ api / sales / ".concat(O.id," "),{method:"DELETE"})).ok&&($(),_(!1),I(null))}catch(e){console.error(e)}},ea=(0,n.useMemo)(()=>e.filter(e=>{var s,t;return(null===(s=e.clientName)||void 0===s?void 0:s.toLowerCase().includes(w.toLowerCase()))||(null===(t=e.invoiceNumber)||void 0===t?void 0:t.toLowerCase().includes(w.toLowerCase()))||e.amount.toString().includes(w)}),[e,w]);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Sales & Finance"}),(0,a.jsxs)(N.Vq,{open:y,onOpenChange:e=>{C(e),e||X()},children:[(0,a.jsx)(N.hg,{asChild:!0,children:(0,a.jsxs)(i.z,{onClick:X,children:[(0,a.jsx)(d.Z,{className:"mr-2 h-4 w-4"})," Record Transaction"]})}),(0,a.jsxs)(N.cZ,{className:"sm:max-w-[500px]",children:[(0,a.jsxs)(N.fK,{children:[(0,a.jsx)(N.$N,{children:k?"Edit Transaction":"Record New Transaction"}),(0,a.jsx)(N.Be,{children:k?"Update transaction details.":"Create an invoice or record a direct sale."})]}),(0,a.jsxs)("form",{onSubmit:ee,children:[(0,a.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(j._,{htmlFor:"type",className:"text-right",children:"Type"}),(0,a.jsxs)(f.Ph,{value:F,onValueChange:R,children:[(0,a.jsx)(f.i4,{className:"col-span-3",children:(0,a.jsx)(f.ki,{})}),(0,a.jsxs)(f.Bw,{children:[(0,a.jsx)(f.Ql,{value:"income",children:"Income"}),(0,a.jsx)(f.Ql,{value:"expense",children:"Expense"})]})]})]}),"income"===F&&(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(j._,{htmlFor:"subType",className:"text-right",children:"Category"}),(0,a.jsxs)(f.Ph,{value:z,onValueChange:A,children:[(0,a.jsx)(f.i4,{className:"col-span-3",children:(0,a.jsx)(f.ki,{})}),(0,a.jsxs)(f.Bw,{children:[(0,a.jsx)(f.Ql,{value:"invoice",children:"Invoice"}),(0,a.jsx)(f.Ql,{value:"sale",children:"Direct Sale"})]})]})]}),"income"===F&&(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(j._,{htmlFor:"client",className:"text-right",children:"Client"}),(0,a.jsxs)(f.Ph,{value:H,onValueChange:K,children:[(0,a.jsx)(f.i4,{className:"col-span-3",children:(0,a.jsx)(f.ki,{placeholder:"Select Client"})}),(0,a.jsx)(f.Bw,{children:P.map(e=>(0,a.jsx)(f.Ql,{value:e.id.toString(),children:e.name},e.id))})]})]}),"income"===F&&"invoice"===z&&(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(j._,{htmlFor:"invoiceNumber",className:"text-right",children:"Invoice #"}),(0,a.jsx)(c.I,{id:"invoiceNumber",value:J,onChange:e=>Y(e.target.value),className:"col-span-3",placeholder:"Auto-generated if empty"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(j._,{htmlFor:"amount",className:"text-right",children:"Total Amount (₹)"}),(0,a.jsx)(c.I,{id:"amount",type:"number",value:E,onChange:e=>L(e.target.value),className:"col-span-3",required:!0})]}),"income"===F&&"invoice"===z&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(j._,{htmlFor:"received",className:"text-right",children:"Received (₹)"}),(0,a.jsx)(c.I,{id:"received",type:"number",value:V,onChange:e=>Z(e.target.value),className:"col-span-3",placeholder:"0.00"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(j._,{htmlFor:"dueDate",className:"text-right",children:"Due Date"}),(0,a.jsx)(c.I,{id:"dueDate",type:"date",value:M,onChange:e=>q(e.target.value),className:"col-span-3"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,a.jsx)(j._,{htmlFor:"status",className:"text-right",children:"Status"}),(0,a.jsxs)(f.Ph,{value:B,onValueChange:U,children:[(0,a.jsx)(f.i4,{className:"col-span-3",children:(0,a.jsx)(f.ki,{})}),(0,a.jsxs)(f.Bw,{children:[(0,a.jsx)(f.Ql,{value:"draft",children:"Draft"}),(0,a.jsx)(f.Ql,{value:"sent",children:"Sent"}),(0,a.jsx)(f.Ql,{value:"paid",children:"Paid"}),(0,a.jsx)(f.Ql,{value:"partial",children:"Partial"}),(0,a.jsx)(f.Ql,{value:"overdue",children:"Overdue"})]})]})]})]})]}),(0,a.jsx)(N.cN,{children:(0,a.jsx)(i.z,{type:"submit",children:k?"Update Transaction":"Save Transaction"})})]})]})]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(u.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,a.jsx)(c.I,{placeholder:"Search transactions...",value:w,onChange:e=>S(e.target.value),className:"pl-10 max-w-md"})]}),(0,a.jsxs)(g.mQ,{defaultValue:"all",children:[(0,a.jsxs)(g.dr,{children:[(0,a.jsx)(g.SP,{value:"all",children:"All Transactions"}),(0,a.jsx)(g.SP,{value:"invoices",children:"Invoices"}),(0,a.jsx)(g.SP,{value:"sales",children:"Direct Sales"})]}),(0,a.jsx)(g.nU,{value:"all",className:"mt-4",children:(0,a.jsx)(o.Zb,{children:(0,a.jsx)(o.aY,{className:"p-0",children:(0,a.jsxs)(v.iA,{children:[(0,a.jsx)(v.xD,{children:(0,a.jsxs)(v.SC,{children:[(0,a.jsx)(v.ss,{children:"Date"}),(0,a.jsx)(v.ss,{children:"Ref #"}),(0,a.jsx)(v.ss,{children:"Client"}),(0,a.jsx)(v.ss,{children:"Type"}),(0,a.jsx)(v.ss,{children:"Amount"}),(0,a.jsx)(v.ss,{children:"Received"}),(0,a.jsx)(v.ss,{children:"Status"}),(0,a.jsx)(v.ss,{className:"text-right",children:"Actions"})]})}),(0,a.jsxs)(v.RM,{children:[t?Array.from({length:5}).map((e,s)=>(0,a.jsxs)(v.SC,{children:[(0,a.jsx)(v.pj,{children:(0,a.jsx)(m.O,{className:"h-4 w-24"})}),(0,a.jsx)(v.pj,{children:(0,a.jsx)(m.O,{className:"h-4 w-20"})}),(0,a.jsx)(v.pj,{children:(0,a.jsx)(m.O,{className:"h-4 w-32"})}),(0,a.jsx)(v.pj,{children:(0,a.jsx)(m.O,{className:"h-4 w-16"})}),(0,a.jsx)(v.pj,{children:(0,a.jsx)(m.O,{className:"h-4 w-20"})}),(0,a.jsx)(v.pj,{children:(0,a.jsx)(m.O,{className:"h-4 w-20"})}),(0,a.jsx)(v.pj,{children:(0,a.jsx)(m.O,{className:"h-4 w-16"})}),(0,a.jsx)(v.pj,{children:(0,a.jsx)(m.O,{className:"h-8 w-16 ml-auto"})})]},s)):ea.map(e=>(0,a.jsxs)(v.SC,{children:[(0,a.jsx)(v.pj,{children:new Date(e.date).toLocaleDateString()}),(0,a.jsx)(v.pj,{className:"font-medium",children:e.invoiceNumber||"-"}),(0,a.jsx)(v.pj,{children:e.clientName||"-"}),(0,a.jsx)(v.pj,{className:"capitalize",children:e.type}),(0,a.jsxs)(v.pj,{children:["₹",e.amount.toLocaleString("en-IN")]}),(0,a.jsxs)(v.pj,{className:"text-green-600",children:["₹",e.amountReceived.toLocaleString("en-IN")]}),(0,a.jsx)(v.pj,{children:(0,a.jsx)(p.C,{variant:"paid"===e.status?"default":"overdue"===e.status?"destructive":"secondary",children:e.status})}),(0,a.jsxs)(v.pj,{className:"text-right space-x-2",children:[(0,a.jsx)(i.z,{variant:"ghost",size:"sm",onClick:()=>W(e),children:(0,a.jsx)(h.Z,{className:"h-4 w-4"})}),(0,a.jsx)(i.z,{variant:"ghost",size:"sm",onClick:()=>es(e),children:(0,a.jsx)(x.Z,{className:"h-4 w-4 text-red-600"})})]})]},e.id)),0===e.length&&!t&&(0,a.jsx)(v.SC,{children:(0,a.jsx)(v.pj,{colSpan:8,className:"text-center py-8 text-gray-500",children:"No transactions found."})})]})]})})})})]}),(0,a.jsx)(r.Q,{open:T,onOpenChange:_,onConfirm:et,title:"Delete Transaction",description:"Are you sure you want to delete this ".concat(null==O?void 0:O.type,"? This action cannot be undone."),confirmText:"Delete"})]})}},3425:function(e,s,t){"use strict";t.d(s,{O:function(){return i}});var a=t(9533),n=t(2284);function i(e){let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,n.cn)("animate-pulse rounded-md bg-muted",s),...t})}},5477:function(e,s,t){"use strict";t.d(s,{RM:function(){return r},SC:function(){return c},iA:function(){return i},pj:function(){return d},ss:function(){return o},xD:function(){return l}});var a=t(9533);t(1229);var n=t(2284);function i(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,a.jsx)("table",{"data-slot":"table",className:(0,n.cn)("w-full caption-bottom text-sm",s),...t})})}function l(e){let{className:s,...t}=e;return(0,a.jsx)("thead",{"data-slot":"table-header",className:(0,n.cn)("[&_tr]:border-b",s),...t})}function r(e){let{className:s,...t}=e;return(0,a.jsx)("tbody",{"data-slot":"table-body",className:(0,n.cn)("[&_tr:last-child]:border-0",s),...t})}function c(e){let{className:s,...t}=e;return(0,a.jsx)("tr",{"data-slot":"table-row",className:(0,n.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",s),...t})}function o(e){let{className:s,...t}=e;return(0,a.jsx)("th",{"data-slot":"table-head",className:(0,n.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t})}function d(e){let{className:s,...t}=e;return(0,a.jsx)("td",{"data-slot":"table-cell",className:(0,n.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t})}},4259:function(e,s,t){"use strict";t.d(s,{SP:function(){return c},dr:function(){return r},mQ:function(){return l},nU:function(){return o}});var a=t(9533);t(1229);var n=t(7883),i=t(2284);function l(e){let{className:s,...t}=e;return(0,a.jsx)(n.fC,{"data-slot":"tabs",className:(0,i.cn)("flex flex-col gap-2",s),...t})}function r(e){let{className:s,...t}=e;return(0,a.jsx)(n.aV,{"data-slot":"tabs-list",className:(0,i.cn)("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",s),...t})}function c(e){let{className:s,...t}=e;return(0,a.jsx)(n.xz,{"data-slot":"tabs-trigger",className:(0,i.cn)("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...t})}function o(e){let{className:s,...t}=e;return(0,a.jsx)(n.VY,{"data-slot":"tabs-content",className:(0,i.cn)("flex-1 outline-none",s),...t})}}},function(e){e.O(0,[890,396,656,49,281,389,170,842,744],function(){return e(e.s=2520)}),_N_E=e.O()}]);